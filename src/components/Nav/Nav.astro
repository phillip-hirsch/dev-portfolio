---
import Icon from "../Icon/Icon.astro";
import type { iconPaths } from "../Icon/IconPaths";
import ThemeToggle from "../ThemeToggle/ThemeToggle.astro";

/** Main menu items */
const textLinks: { label: string; href: string }[] = [
  { label: "Home", href: "/" },
  { label: "About", href: "/about/" },
  { label: "Experience", href: "/experience/" },
  { label: "Resume", href: "/resume/" },
];

/** Icon links to social media — edit these with links to your profiles! */
const iconLinks: {
  label: string;
  href: string;
  icon: keyof typeof iconPaths;
}[] = [
  {
    label: "LinkedIn",
    href: "https://www.linkedin.com/in/phillip-hirsch",
    icon: "linkedin-logo",
  },
  {
    label: "GitHub",
    href: "https://github.com/phillip-hirsch",
    icon: "github-logo",
  },
];

/** Test if a link is pointing to the current page. */
const isCurrentPage = (href: string) => {
  let pathname = Astro.url.pathname.replace(import.meta.env.BASE_URL, "");
  if (pathname.at(0) !== "/") pathname = "/" + pathname;
  if (pathname.at(-1) !== "/") pathname += "/";
  return pathname === href || (href !== "/" && pathname.startsWith(href));
};
---

<nav
  class="z-[9999] relative font-brand font-medium mb-14 lg:grid lg:grid-cols-[1fr_auto_1fr] lg:items-center lg:px-20 lg:py-10 lg:gap-4"
>
  <div class="flex justify-between gap-2 p-6 lg:p-0">
    <a
      href="/"
      class="flex gap-2 items-center leading-tight text-gray-0 no-underline lg:text-lg"
    >
      <Icon
        icon="terminal-window"
        color="var(--color-accent-regular)"
        size="1.6em"
        gradient
      />
      Phillip Hirsch
    </a>
    <menu-button>
      <template>
        <button
          class="relative flex border-0 rounded-full p-2 text-2xl text-gray-300 bg-[radial-gradient(var(--color-gray-900),var(--color-gray-800)_150%)] shadow-md before:absolute before:inset-[-1px] before:content-[''] before:bg-[image:var(--gradient-stroke)] before:rounded-full before:-z-10 aria-expanded:text-gray-0 aria-expanded:bg-[linear-gradient(180deg,var(--color-gray-600),transparent),radial-gradient(var(--color-gray-900),var(--color-gray-800)_150%)]"
          aria-expanded="false"
        >
          <span class="sr-only">Menu</span>
          <Icon icon="list" />
        </button>
      </template>
    </menu-button>
  </div>
  <noscript>
    <ul
      class="m-0 flex flex-col gap-4 text-md leading-tight list-none p-8 bg-gray-999 border-b border-gray-800 lg:relative lg:flex-row lg:text-sm lg:rounded-full lg:border-0 lg:px-2 lg:py-2 lg:bg-[radial-gradient(var(--color-gray-900),var(--color-gray-800)_150%)] lg:shadow-md lg:before:absolute lg:before:inset-[-1px] lg:before:content-[''] lg:before:bg-[image:var(--gradient-stroke)] lg:before:rounded-full lg:before:-z-10"
    >
      {
        textLinks.map(({ label, href }) => (
          <li>
            <a
              aria-current={isCurrentPage(href) ? "page" : null}
              class="inline-block text-gray-300 no-underline aria-[current=page]:text-gray-0 lg:px-4 lg:py-2 lg:rounded-full lg:transition-colors lg:duration-200 lg:hover:text-gray-100 lg:hover:bg-accent-subtle-overlay lg:aria-[current=page]:text-accent-text-over lg:aria-[current=page]:bg-accent-regular"
              href={href}
            >
              {label}
            </a>
          </li>
        ))
      }
    </ul>
  </noscript>
  <noscript>
    <div
      class="flex justify-between gap-3 py-6 px-8 bg-gray-999 rounded-b-xl shadow-lg lg:justify-self-end lg:items-center lg:p-0 lg:bg-transparent lg:shadow-none"
    >
      <div class="flex flex-wrap gap-2.5 text-xl lg:hidden xl:flex xl:justify-end xl:gap-0">
        {
          iconLinks.map(({ href, icon, label }) => (
            <a
              href={href}
              class="flex p-2 no-underline text-accent-dark transition-colors duration-200 hover:text-accent-text-over"
            >
              <span class="sr-only">{label}</span>
              <Icon icon={icon} />
            </a>
          ))
        }
      </div>
    </div>
  </noscript>
  <div id="menu-content" hidden>
    <ul
      class="m-0 flex flex-col gap-4 text-md leading-tight list-none p-8 bg-gray-999 border-b border-gray-800 lg:relative lg:flex-row lg:text-sm lg:rounded-full lg:border-0 lg:px-2 lg:py-2 lg:bg-[radial-gradient(var(--color-gray-900),var(--color-gray-800)_150%)] lg:shadow-md lg:before:absolute lg:before:inset-[-1px] lg:before:content-[''] lg:before:bg-[image:var(--gradient-stroke)] lg:before:rounded-full lg:before:-z-10"
    >
      {
        textLinks.map(({ label, href }) => (
          <li>
            <a
              aria-current={isCurrentPage(href) ? "page" : null}
              class="inline-block text-gray-300 no-underline aria-[current=page]:text-gray-0 lg:px-4 lg:py-2 lg:rounded-full lg:transition-colors lg:duration-200 lg:hover:text-gray-100 lg:hover:bg-accent-subtle-overlay lg:aria-[current=page]:text-accent-text-over lg:aria-[current=page]:bg-accent-regular"
              href={href}
            >
              {label}
            </a>
          </li>
        ))
      }
    </ul>
    <div
      class="flex justify-between gap-3 py-6 px-8 bg-gray-999 rounded-b-xl shadow-lg lg:justify-self-end lg:items-center lg:p-0 lg:bg-transparent lg:shadow-none"
    >
      <div class="flex flex-wrap gap-2.5 text-xl lg:hidden xl:flex xl:justify-end xl:gap-0">
        {
          iconLinks.map(({ href, icon, label }) => (
            <a
              href={href}
              class="flex p-2 no-underline text-accent-dark transition-colors duration-200 hover:text-accent-text-over"
            >
              <span class="sr-only">{label}</span>
              <Icon icon={icon} />
            </a>
          ))
        }
      </div>

      <div class="flex items-center">
        <ThemeToggle />
      </div>
    </div>
  </div>
</nav>

<script>
  import "./Nav";
</script>

<style>
  /* menu-content position/display — JS toggles hidden; these classes drive animation */
  .menu-content {
    position: absolute;
    left: 0;
    right: 0;
    transform-origin: top center;
    overflow: hidden;
  }

  .menu-content.is-open {
    animation: var(--animate-menu-slide-down);
  }

  .menu-content.is-closing {
    animation: var(--animate-menu-slide-up);
  }

  /* On desktop, menu-content uses display:contents so it slots into the grid */
  @media (min-width: 50em) {
    .menu-content {
      display: contents;
      animation: none !important;
      transform: none !important;
      opacity: 1 !important;
      overflow: visible;
    }
  }

  @media (forced-colors: active) {
    .link[aria-current="page"] {
      color: SelectedItem;
    }
  }
</style>
